name: scrape

on:
    workflow_dispatch: 
      inputs:
        bootstrap:
          description: 'Run with --bootstrap?'
          required: true
          type: boolean
          default: false

jobs:
    scrape:
        runs-on: ubuntu-latest
        steps:
        - name: Check out repo
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
        - name: Install dependencies
          run: pip3 install -r requirements.txt
        - name: Scrape
          run: |
            if ${{ github.event.inputs.bootstrap }}; then
              ./scrape.sh --bootstrap
            else
              ./scrape.sh
            fi
        - name: Commit files
          run: |
            git config --local user.email "github-actions[bot]@users.noreply.github.com"
            git config --local user.name "github-actions[bot]"
            git add -f *.csv
            git add -f *.db
            git commit -m "Update csv exports and db"